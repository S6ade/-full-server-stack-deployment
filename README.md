# Проект: Развертывание и настройка веб-сервера (nginx + PHP-FPM) на Ubuntu в VirtualBox
### *Цель проекта:* Получить практический опыт развертывания полноценного веб-стенда с нуля. Проект включает создание виртуальной машины, установку и настройку веб-сервера nginx, организацию удаленного доступа по SSH, интеграцию PHP через PHP-FPM и базовое управление контентом.
### Этот гайд документирует все шаги, которые я выполнил вручную, что демонстрирует понимание работы сетей, Linux-администрирования и стека LEMP.
----

### **Содержание:**

1. Подготовка виртуальной машины (ВМ) в VirtualBox

2. Установка и базовая проверка nginx

3. Настройка SSH для удаленного управления

4. Публикация веб-сервера на локальную машину

5. Изменение стартовой страницы nginx

6. Интеграция PHP-FPM для обработки PHP-скриптов

7. Создание и структурирование тестового сайта


### **Подготовка виртуальной машины**
*Для запуска веб-сервера необходимо подготовить виртуальную среду.*

1. ***Загрузка ОС:*** Скачайте актуальный [дистрибутив Ubuntu Server](https://ubuntu.com/download/server).

2. ***Создание ВМ:*** Откройте VirtualBox и нажмите кнопку ***"Создать"***.

3. ***Настройка ВМ:*** Укажите имя, папку для сохранения и выберите загруженный ISO-образ Ubuntu.

4. ***Ручная настройка:*** Рекомендуется активировать опцию ***"Пропустить автоматическую установку"*** для гибкой настройки параметров.

5. ***Выделение ресурсов:*** Задайте объем оперативной памяти (ОЗУ), количество ядер процессора и размер виртуального жесткого диска в соответствии с [системными требованиями Ubuntu](https://ubuntu.com/server/docs/tutorial/basic-installation/).

6. ***Запуск и установка:*** Нажмите ***"Запустить"***. После старта ВМ дважды кликните по ней, чтобы открыть консоль, и пройдите стандартный процесс установки ОС (укажите имя пользователя, пароль, часовой пояс и т.д.).

7. ***Завершение:*** После установки перезагрузите систему и извлеките установочный образ из виртуального привода.

### **Установка nginx**
Залогиньтесь в систему и откройте терминал `(Ctrl + Alt + T)`.

**1. Обновление системы:**
```bash
	sudo apt update && sudo apt upgrade -y
```
**2. Установка nginx:**
```bash
	sudo apt install nginx -y
```
**3. Проверка работы:** Откройте браузер внутри ВМ и перейдите по адресу  *http://localhost*. Должна отобразиться стартовая страница nginx.

### **Настройка SSH**
*Для удобного управления ВМ с локальной машины настроим SSH-доступ.*

### ***На ВМ (гостевая система):***

1. **Установите SSH-сервер:**
```bash
	sudo apt install openssh-server -y
```
2. **Включите автозапуск службы и проверьте ее статус:**
```bash
	sudo systemctl enable ssh
	sudo systemctl status ssh
```
### **В VirtualBox (проброс портов):**

*Чтобы подключиться к ВМ с хостовой машины, необходимо пробросить порт.*

1. Выключите ВМ. В VirtualBox откройте её `Settings -> Network -> Adapter 1 -> Port Forwarding`.

2. Добавьте новое правило:
```
		name: ssh
		protocol: TCP
		Host IP: 127.0.0.1
		Host Port: 2222
		Guest  IP: оставить пустым
		Guest Port: 22
```

### **Подключение с локальной машины:**
*Теперь подключиться к ВМ можно из терминала `PowerShell/CMD/Bash`:*
```bash
	ssh ваш_пользователь@127.0.0.1 -p 2222
```
### **Публикация веб-сервера**
*Чтобы получить доступ к веб-серверу nginx с локальной машины, также пробросим порт.*
1. В настройках сети VirtualBox `(как в шаге выше)` добавьте еще одно правило:
```
		name: nginx
		protocol: TCP
		Host IP: 127.0.0.1
		Host Port: 8080
		Guest  IP: оставить пустым
		Guest Port: 80
```
2. **Проверка:** Откройте браузер на локальной машине и перейдите по адресу *http://localhost:8080*. Вы увидите стартовую страницу nginx, но уже обслуживаемую с ВМ.

### **Изменение стартовой страницы**
*Настроим кастомную стартовую страницу.*
1. Найдите корневую директорию веб-сервера. В конфигурации nginx по умолчанию это `/var/www/html`.
2. ## **Важно!** Создайте резервную копию оригинального файла:
```bash
	sudo cp /var/www/html/index.nginx-debian.html     /var/www/html/index.nginx-debian.html.bak
```
3. Отредактируйте файл `index.nginx-debian.html`:
```bash
	sudo nano /var/www/html/index.nginx-debian.html
```
4. Замените его содержимое на простое:
```html
	<html>
		<body>
			It works! <br> Hello, world!
	</body>
</html>
```
5. Сохраните изменения `(Ctrl+O, Enter, Ctrl+X)` и перезагрузите nginx:
 ```bash
	sudo systemctl restart nginx
```
6. Обновите страницу *http://localhost:8080* в браузере локальной машины. Теперь отобразится ваше изменение.

### **Установка PHP-FPM**
*Для обработки PHP-скриптов свяжем nginx с PHP-FPM. Это повышает производительность и стабильность.*
1. Установите PHP-FPM (для примера, версия 8.3):
 ```bash
	sudo apt install php8.3-fpm -y
```
2. Отредактируйте конфигурационный файл сайта nginx:
```bash
	sudo nano /etc/nginx/sites-available/default
```
3. В блоке `server` найдите строку `index` и добавьте `index.php`:
```bash
	index index.php index.html index.htm index.nginx-debian.html;
```
4. Раскомментируйте или добавьте блок обработки PHP-файлов:
```bash
	location ~ \.php$ {
    include snippets/fastcgi-php.conf;
    fastcgi_pass unix:/run/php/php8.3-fpm.sock;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include fastcgi_params;
}
```
5. **Пояснение конфигурации:**
   + `index index.php ...` — говорит nginx искать `index.php` как индексный файл.

   + `fastcgi_pass` — указывает сокет, через который nginx взаимодействует с PHP-FPM.

   + `fastcgi_param SCRIPT_FILENAME` — передает PHP-FPM путь к запрашиваемому скрипту.\
6. Проверьте корректность конфигурации и перезапустите службы:
 ```bash
	sudo nginx -t
	sudo systemctl restart php8.3-fpm
	sudo systemctl restart nginx
```
### **Создание тестового сайта**
*Создадим простую структуру сайта с несколькими страницами.*
1. Создайте директорию для сайта и базовый `index.php`:
 ```bash
	sudo mkdir -p /var/www/html/testsite
	sudo nano /var/www/html/testsite/index.php
```
2. Добавьте в файл содержимое:
```php
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тестовый сайт</title>
</head>
<body>
    <h1>Добро пожаловать на сайт!</h1>
    <p>Это главная страница.</p>
    <p>Посмотрите, что есть ещё:</p>
    <ul>
        <li><a href="page1">Дополнительная страница</a></li>
    </ul>
</body>
</html>
```
3. Создайте поддиректорию и вторую страницу:
 ```bash
	sudo mkdir /var/www/html/testsite/page1
	sudo nano /var/www/html/testsite/page1/index.php
```
4. Добавьте содержимое второй страницы:
 ```php
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Страница 1</title>
</head>
<body>
    <h1>Это ещё одна страница</h1>
    <p>Тут может быть кое-что ещё.</p>
    <a href="/testsite">Вернуться на главную</a>
</body>
</html>
```
5. **Финальная проверка:** Откройте в браузере локальной машины адрес *http://localhost:8080/testsite*. Вы увидите главную страницу с рабочей ссылкой, ведущей на вторую страницу сайта.
----
### **Итог**
***В ходе этого проекта были выполнены и задокументированы следующие задачи:***

1. Развертывание изолированной среды на базе Ubuntu Server в VirtualBox.

2. Установка и конфигурация веб-сервера nginx.

3. Настройка сетевого моста (NAT с пробросом портов) для доступа к сервисам ВМ с хостовой машины.

4. Организация безопасного удаленного управления через SSH.

5. Интеграция и настройка связки nginx + PHP-FPM для обработки динамического контента.

6. Практика базового Linux-администрирования: работа с системами инициализации (systemctl), редактирование конфигурационных файлов, управление правами.

7. Создание простой структуры веб-сайта с внутренней навигацией.
